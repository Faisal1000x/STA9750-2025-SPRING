<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>STA 9750 Mini-Project 02: Identifying Environmentally Responsible US Public Transit Systems</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="mp02_files/libs/clipboard/clipboard.min.js"></script>
<script src="mp02_files/libs/quarto-html/quarto.js"></script>
<script src="mp02_files/libs/quarto-html/popper.min.js"></script>
<script src="mp02_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="mp02_files/libs/quarto-html/anchor.min.js"></script>
<link href="mp02_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="mp02_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="mp02_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="mp02_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="mp02_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="mp02_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="mp02_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<link href="mp02_files/libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">

<script src="mp02_files/libs/datatables-binding-0.33/datatables.js"></script>

<script src="mp02_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="mp02_files/libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">

<link href="mp02_files/libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">

<script src="mp02_files/libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>

<link href="mp02_files/libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="mp02_files/libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<script src="mp02_files/libs/kePrint-0.0.1/kePrint.js"></script>

<link href="mp02_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">



</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#table-of-contents" id="toc-table-of-contents" class="nav-link active" data-scroll-target="#table-of-contents">Table of Contents</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#task-1-data-import" id="toc-task-1-data-import" class="nav-link" data-scroll-target="#task-1-data-import">Task 1: Data Import</a>
  <ul class="collapse">
  <li><a href="#key-metrics-extracted" id="toc-key-metrics-extracted" class="nav-link" data-scroll-target="#key-metrics-extracted">Key Metrics Extracted:</a></li>
  <li><a href="#table-construction" id="toc-table-construction" class="nav-link" data-scroll-target="#table-construction">Table Construction:</a></li>
  </ul></li>
  <li><a href="#task-2-initial-analysis-of-sep-data" id="toc-task-2-initial-analysis-of-sep-data" class="nav-link" data-scroll-target="#task-2-initial-analysis-of-sep-data">Task 2: Initial Analysis of SEP Data</a>
  <ul class="collapse">
  <li><a href="#key-insights" id="toc-key-insights" class="nav-link" data-scroll-target="#key-insights">Key Insights:</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  </ul></li>
  <li><a href="#task-3-recoding-the-mode-column" id="toc-task-3-recoding-the-mode-column" class="nav-link" data-scroll-target="#task-3-recoding-the-mode-column">Task 3: Recoding the Mode Column</a>
  <ul class="collapse">
  <li><a href="#ntd-service-data" id="toc-ntd-service-data" class="nav-link" data-scroll-target="#ntd-service-data">NTD Service Data:</a></li>
  </ul></li>
  <li><a href="#task-4-explore-ntd-service-data" id="toc-task-4-explore-ntd-service-data" class="nav-link" data-scroll-target="#task-4-explore-ntd-service-data">Task 4: Explore NTD Service Data</a>
  <ul class="collapse">
  <li><a href="#key-findings" id="toc-key-findings" class="nav-link" data-scroll-target="#key-findings">Key Findings:</a></li>
  </ul></li>
  <li><a href="#task-5-calculate-emissions" id="toc-task-5-calculate-emissions" class="nav-link" data-scroll-target="#task-5-calculate-emissions">Task 5: Calculate Emissions</a>
  <ul class="collapse">
  <li><a href="#steps" id="toc-steps" class="nav-link" data-scroll-target="#steps">Steps:</a></li>
  </ul></li>
  <li><a href="#task-6-normalize-emissions-to-transit-usage" id="toc-task-6-normalize-emissions-to-transit-usage" class="nav-link" data-scroll-target="#task-6-normalize-emissions-to-transit-usage">Task 6: Normalize Emissions to Transit Usage</a>
  <ul class="collapse">
  <li><a href="#key-findings-1" id="toc-key-findings-1" class="nav-link" data-scroll-target="#key-findings-1">Key Findings:</a></li>
  </ul></li>
  <li><a href="#task-7-determine-award-winners" id="toc-task-7-determine-award-winners" class="nav-link" data-scroll-target="#task-7-determine-award-winners">Task 7: Determine Award Winners</a>
  <ul class="collapse">
  <li><a href="#award-categories" id="toc-award-categories" class="nav-link" data-scroll-target="#award-categories">Award Categories:</a></li>
  </ul></li>
  <li><a href="#task-8-visualization" id="toc-task-8-visualization" class="nav-link" data-scroll-target="#task-8-visualization">Task 8: Visualization</a>
  <ul class="collapse">
  <li><a href="#key-visualizations" id="toc-key-visualizations" class="nav-link" data-scroll-target="#key-visualizations">Key Visualizations:</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">STA 9750 Mini-Project 02: Identifying Environmentally Responsible US Public Transit Systems</h1>
<p class="subtitle lead">Green Transit Alliance for Investigation of Variance (GTA IV)</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="table-of-contents" class="level2">
<h2 class="anchored" data-anchor-id="table-of-contents">Table of Contents</h2>
<ol type="1">
<li><a href="#introduction">Introduction</a></li>
<li><a href="#task-1-data-import">Task 1: Data Import</a></li>
<li><a href="#task-2-initial-analysis-of-sep-data">Task 2: Initial Analysis of SEP Data</a></li>
<li><a href="#task-3-recoding-the-mode-column">Task 3: Recoding the Mode Column</a></li>
<li><a href="#task-4-explore-ntd-service-data">Task 4: Explore NTD Service Data</a></li>
<li><a href="#task-5-calculate-emissions">Task 5: Calculate Emissions</a></li>
<li><a href="#task-6-normalize-emissions-to-transit-usage">Task 6: Normalize Emissions to Transit Usage</a></li>
<li><a href="#task-7-determine-award-winners">Task 7: Determine Award Winners</a></li>
<li><a href="#task-8-visualization">Task 8: Visualization</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ol>
<hr>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This report provides a comprehensive analysis of the environmental impact of public transit systems across the United States, focusing on electricity generation sources, CO₂ emissions, and energy consumption. The analysis incorporates data from the U.S. Energy Information Administration (EIA) State Electricity Profiles (SEP) and the National Transit Database (NTD). The primary objective of this project is to identify key trends, insights, and best practices for improving the sustainability of transit systems.</p>
<p>Key areas covered in this report include: - The environmental impact of electricity generation in each state, focusing on CO₂ emissions, energy prices, and generation capacity. - The energy consumption of public transit systems and their contributions to CO₂ emissions. - A comparison of emissions and energy efficiency between various transit agencies across the U.S. - The identification of best-performing agencies and their role in fostering sustainable transit practices.</p>
<hr>
</section>
<section id="task-1-data-import" class="level2">
<h2 class="anchored" data-anchor-id="task-1-data-import">Task 1: Data Import</h2>
<p>In this task, we focus on downloading and parsing the U.S. Energy Information Administration’s (EIA) state electricity profiles (SEP) for analysis.</p>
<section id="key-metrics-extracted" class="level3">
<h3 class="anchored" data-anchor-id="key-metrics-extracted">Key Metrics Extracted:</h3>
<ol type="1">
<li><strong>CO₂ Emissions per MWh:</strong> This metric measures the environmental impact of electricity generation in each state. States with high CO₂ emissions are those that rely heavily on fossil fuels like coal.</li>
<li><strong>Primary Energy Sources:</strong> This includes an analysis of the energy sources used for electricity generation in each state (e.g., coal, natural gas, renewables). Understanding these sources helps gauge the sustainability of electricity generation methods.</li>
<li><strong>Electricity Price and Generation Capacity:</strong> These metrics provide insights into the cost of electricity and the total capacity for energy generation in each state.</li>
</ol>
</section>
<section id="table-construction" class="level3">
<h3 class="anchored" data-anchor-id="table-construction">Table Construction:</h3>
<p>The processed data is presented in an interactive table, which includes the following columns: - <strong>State:</strong> The name of the U.S. state. - <strong>CO₂ Emissions per MWh:</strong> The average CO₂ emissions produced per MWh of electricity. - <strong>Primary Energy Sources:</strong> A list of the most common energy sources used in each state. - <strong>Electricity Price (per MWh):</strong> The average price of electricity in each state. - <strong>Generation Capacity (in MW):</strong> The total electricity generation capacity in the state.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datasets)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr) </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(scales))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(dplyr))</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to ensure required packages are installed and loaded</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>ensure_package <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg){</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    pkg <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(pkg))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>))</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>)) <span class="fu">install.packages</span>(pkg)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>))</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to download and parse EIA State Electricity Profiles</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>get_eia_sep <span class="ot">&lt;-</span> <span class="cf">function</span>(state, abbr){</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    state_formatted <span class="ot">&lt;-</span> <span class="fu">str_to_lower</span>(state) <span class="sc">|&gt;</span> <span class="fu">str_replace_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>, <span class="st">""</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a directory to store data</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    dir_name <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    file_name <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_name, <span class="fu">paste0</span>(state_formatted, <span class="st">".html"</span>))</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(dir_name, <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Download and save the file if it doesn't exist</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(file_name)){</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        BASE_URL <span class="ot">&lt;-</span> <span class="st">"https://www.eia.gov"</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        REQUEST <span class="ot">&lt;-</span> <span class="fu">request</span>(BASE_URL) <span class="sc">|&gt;</span> <span class="fu">req_url_path</span>(<span class="st">"electricity"</span>, <span class="st">"state"</span>, state_formatted)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>        RESPONSE <span class="ot">&lt;-</span> <span class="fu">req_perform</span>(REQUEST)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resp_check_status</span>(RESPONSE)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        <span class="fu">writeLines</span>(<span class="fu">resp_body_string</span>(RESPONSE), file_name)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read and parse the HTML data table</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    TABLE <span class="ot">&lt;-</span> <span class="fu">read_html</span>(file_name) <span class="sc">|&gt;</span> </span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">html_element</span>(<span class="st">"table"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">html_table</span>() <span class="sc">|&gt;</span> </span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">Item =</span> <span class="fu">str_to_lower</span>(Item))</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rename column if needed</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="st">"U.S. rank"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(TABLE)){</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>        TABLE <span class="ot">&lt;-</span> TABLE <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">Rank =</span> <span class="st">`</span><span class="at">U.S. rank</span><span class="st">`</span>)</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract key electricity data</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    CO2_MWh <span class="ot">&lt;-</span> TABLE <span class="sc">|&gt;</span> <span class="fu">filter</span>(Item <span class="sc">==</span> <span class="st">"carbon dioxide (lbs/mwh)"</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(Value) <span class="sc">|&gt;</span> <span class="fu">str_replace_all</span>(<span class="st">","</span>, <span class="st">""</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    PRIMARY <span class="ot">&lt;-</span> TABLE <span class="sc">|&gt;</span> <span class="fu">filter</span>(Item <span class="sc">==</span> <span class="st">"primary energy source"</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(Rank)</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    RATE <span class="ot">&lt;-</span> TABLE <span class="sc">|&gt;</span> <span class="fu">filter</span>(Item <span class="sc">==</span> <span class="st">"average retail price (cents/kwh)"</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(Value) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    GENERATION_MWh <span class="ot">&lt;-</span> TABLE <span class="sc">|&gt;</span> <span class="fu">filter</span>(Item <span class="sc">==</span> <span class="st">"net generation (megawatthours)"</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(Value) <span class="sc">|&gt;</span> <span class="fu">str_replace_all</span>(<span class="st">","</span>, <span class="st">""</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a structured dataframe</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">CO2_MWh =</span> CO2_MWh,</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">primary_source =</span> PRIMARY,</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">electricity_price_MWh =</span> RATE <span class="sc">*</span> <span class="dv">10</span>,  <span class="co"># Convert cents/kWh to dollars/MWh</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">generation_MWh =</span> GENERATION_MWh,</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">state =</span> state,</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">abbreviation =</span> abbr</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch electricity profile data for all U.S. states</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>EIA_SEP_REPORT <span class="ot">&lt;-</span> <span class="fu">map2</span>(state.name, state.abb, get_eia_sep) <span class="sc">|&gt;</span> <span class="fu">list_rbind</span>()</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Format and display the table</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>EIA_SEP_REPORT <span class="sc">|&gt;</span> </span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>abbreviation) <span class="sc">|&gt;</span> </span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(CO2_MWh)) <span class="sc">|&gt;</span> </span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>        <span class="at">CO2_MWh =</span> <span class="fu">number</span>(CO2_MWh, <span class="at">big.mark=</span><span class="st">","</span>),</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>        <span class="at">electricity_price_MWh =</span> <span class="fu">dollar</span>(electricity_price_MWh),</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>        <span class="at">generation_MWh =</span> <span class="fu">number</span>(generation_MWh, <span class="at">big.mark=</span><span class="st">","</span>)</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Pounds of CO2 Emitted per MWh of Electricity Produced</span><span class="st">`</span> <span class="ot">=</span> CO2_MWh,</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Primary Source of Electricity Generation</span><span class="st">`</span> <span class="ot">=</span> primary_source,</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Average Retail Price for 1000 kWh</span><span class="st">`</span> <span class="ot">=</span> electricity_price_MWh,</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Total Generation Capacity (MWh)</span><span class="st">`</span> <span class="ot">=</span> generation_MWh,</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>        <span class="at">State =</span> state</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">datatable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-169163baadd6ca0a874b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-169163baadd6ca0a874b">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50"],["1,925","1,864","1,741","1,514","1,497","1,444","1,414","1,354","1,180","1,148","1,127","1,103","1,095","1,054","1,044","987","966","923","912","855","847","817","801","794","775","763","759","733","727","715","684","655","654","648","639","594","576","558","558","522","522","518","440","428","370","369","344","292","269","8"],["Coal","Coal","Coal","Coal","Coal","Petroleum","Coal","Coal","Natural gas","Natural gas","Coal","Coal","Natural gas","Coal","Natural gas","Natural gas","Natural gas","Natural gas","Natural gas","Natural gas","Natural gas","Natural gas","Wind","Natural gas","Wind","Wind","Wind","Natural gas","Natural gas","Nuclear","Natural gas","Natural gas","Natural gas","Natural gas","Natural gas","Natural gas","Natural gas","Natural gas","Nuclear","Nuclear","Natural gas","Natural gas","Natural gas","Natural gas","Hydroelectric","Wind","Hydroelectric","Hydroelectric","Nuclear","Hydroelectric"],["$102.60","$83.90","$99.60","$108.70","$114.90","$386.00","$80.30","$90.30","$214.10","$127.20","$109.70","$91.40","$128.50","$117.60","$110.40","$97.30","$89.10","$232.10","$136.80","$100.40","$216.20","$109.50","$122.10","$135.30","$94.20","$108.00","$94.70","$110.60","$114.70","$106.90","$121.90","$125.70","$130.90","$93.00","$106.10","$106.80","$242.40","$143.40","$105.00","$117.50","$182.80","$152.70","$248.70","$208.40","$90.80","$104.90","$103.20","$95.80","$229.60","$175.30"],["52,286,784","43,181,420","63,217,080","66,703,285","90,046,880","9,194,164","42,068,807","33,496,554","6,717,825","62,548,705","26,895,758","39,445,955","4,772,059","57,541,720","133,223,464","63,195,647","97,784,565","19,695,884","120,656,625","547,294,552","10,430,846","72,933,440","57,276,862","259,798,479","69,836,973","58,456,598","39,269,073","129,221,513","139,435,010","77,791,204","111,838,736","235,924,937","42,164,375","89,236,024","126,553,394","91,059,344","40,666,418","36,000,650","100,853,387","177,737,641","124,039,988","64,228,924","216,628,794","12,512,181","17,842,446","17,436,158","61,691,869","102,960,605","16,824,999","2,480,199"],["West Virginia","Wyoming","Kentucky","Missouri","Indiana","Hawaii","North Dakota","Utah","Alaska","Wisconsin","Montana","Nebraska","Delaware","Colorado","Ohio","Arkansas","Louisiana","Massachusetts","Michigan","Texas","Rhode Island","Mississippi","Minnesota","Florida","Iowa","Kansas","New Mexico","Georgia","Alabama","Tennessee","Arizona","Pennsylvania","Nevada","Oklahoma","North Carolina","Virginia","Connecticut","Maryland","South Carolina","Illinois","New York","New Jersey","California","Maine","Idaho","South Dakota","Oregon","Washington","New Hampshire","Vermont"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Pounds of CO2 Emitted per MWh of Electricity Produced<\/th>\n      <th>Primary Source of Electricity Generation<\/th>\n      <th>Average Retail Price for 1000 kWh<\/th>\n      <th>Total Generation Capacity (MWh)<\/th>\n      <th>State<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Pounds of CO2 Emitted per MWh of Electricity Produced","targets":1},{"name":"Primary Source of Electricity Generation","targets":2},{"name":"Average Retail Price for 1000 kWh","targets":3},{"name":"Total Generation Capacity (MWh)","targets":4},{"name":"State","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<hr>
</section>
</section>
<section id="task-2-initial-analysis-of-sep-data" class="level2">
<h2 class="anchored" data-anchor-id="task-2-initial-analysis-of-sep-data">Task 2: Initial Analysis of SEP Data</h2>
<section id="key-insights" class="level3">
<h3 class="anchored" data-anchor-id="key-insights">Key Insights:</h3>
<ol type="1">
<li><strong>Most Expensive Electricity:</strong>
<ul>
<li><strong>Hawaii</strong> was identified as having the highest electricity prices in the U.S. This is largely due to the state’s reliance on imported fuel, which drives up the cost of electricity.</li>
</ul></li>
<li><strong>Dirtiest State:</strong>
<ul>
<li><strong>West Virginia</strong> was flagged as the state with the highest CO₂ emissions due to its dependence on coal for electricity generation. Coal is a major contributor to high emissions levels, which poses a challenge for reducing the environmental impact of energy production.</li>
</ul></li>
<li><strong>Weighted Average CO₂ Emissions:</strong>
<ul>
<li>A weighted average CO₂ emission value was calculated to benchmark the environmental performance of different states. This value provides an overview of how efficiently each state generates electricity in terms of emissions.</li>
</ul></li>
<li><strong>Rare Primary Energy Source:</strong>
<ul>
<li>The script identified the least common energy source in the dataset, providing insight into less conventional methods of electricity generation. This information could lead to discussions on exploring more sustainable or innovative energy sources.</li>
</ul></li>
<li><strong>Comparison Between New York and Texas:</strong>
<ul>
<li>A comparison of CO₂ emissions between <strong>New York</strong> and <strong>Texas</strong> revealed that New York produces cleaner electricity compared to Texas. This aligns with New York’s heavy investment in renewable energy sources, such as wind and solar power.</li>
</ul></li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(tidyverse))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(EIA_SEP_REPORT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 50
Columns: 6
$ CO2_MWh               &lt;dbl&gt; 727, 1180, 684, 987, 440, 1054, 576, 1095, 794, …
$ primary_source        &lt;chr&gt; "Natural gas", "Natural gas", "Natural gas", "Na…
$ electricity_price_MWh &lt;dbl&gt; 114.7, 214.1, 121.9, 97.3, 248.7, 117.6, 242.4, …
$ generation_MWh        &lt;dbl&gt; 139435010, 6717825, 111838736, 63195647, 2166287…
$ state                 &lt;chr&gt; "Alabama", "Alaska", "Arizona", "Arkansas", "Cal…
$ abbreviation          &lt;chr&gt; "AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", …</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>most_expensive_state <span class="ot">&lt;-</span> EIA_SEP_REPORT <span class="sc">|&gt;</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(electricity_price_MWh)) <span class="sc">|&gt;</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(state, electricity_price_MWh) <span class="sc">|&gt;</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(most_expensive_state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   state electricity_price_MWh
1 Hawaii                   386</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>dirtiest_state <span class="ot">&lt;-</span> EIA_SEP_REPORT <span class="sc">|&gt;</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(CO2_MWh)) <span class="sc">|&gt;</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(state, CO2_MWh) <span class="sc">|&gt;</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dirtiest_state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          state CO2_MWh
1 West Virginia    1925</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>weighted_avg_CO2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(EIA_SEP_REPORT<span class="sc">$</span>CO2_MWh <span class="sc">*</span> EIA_SEP_REPORT<span class="sc">$</span>generation_MWh) <span class="sc">/</span> <span class="fu">sum</span>(EIA_SEP_REPORT<span class="sc">$</span>generation_MWh)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(weighted_avg_CO2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 805.3703</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>rare_energy <span class="ot">&lt;-</span> EIA_SEP_REPORT <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(primary_source, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(n) <span class="sc">|&gt;</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>rare_energy_state <span class="ot">&lt;-</span> EIA_SEP_REPORT <span class="sc">|&gt;</span> </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(primary_source <span class="sc">==</span> rare_energy<span class="sc">$</span>primary_source) <span class="sc">|&gt;</span> </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(state, primary_source, electricity_price_MWh) <span class="sc">|&gt;</span> </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(electricity_price_MWh) </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">list</span>(rare_energy, rare_energy_state))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
  primary_source n
1      Petroleum 1

[[2]]
   state primary_source electricity_price_MWh
1 Hawaii      Petroleum                   386</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>NY_TX_CO2 <span class="ot">&lt;-</span> EIA_SEP_REPORT <span class="sc">|&gt;</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(state <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"New York"</span>, <span class="st">"Texas"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(state, CO2_MWh)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>clean_ratio <span class="ot">&lt;-</span> NY_TX_CO2<span class="sc">$</span>CO2_MWh[NY_TX_CO2<span class="sc">$</span>state <span class="sc">==</span> <span class="st">"Texas"</span>] <span class="sc">/</span> NY_TX_CO2<span class="sc">$</span>CO2_MWh[NY_TX_CO2<span class="sc">$</span>state <span class="sc">==</span> <span class="st">"New York"</span>]</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(clean_ratio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.637931</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>ensure_package <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg){</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    pkg <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(pkg))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>)) <span class="fu">install.packages</span>(pkg)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>))</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(readxl)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create directory if it doesn't exist</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>DATA_DIR <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(DATA_DIR, <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>NTD_ENERGY_FILE <span class="ot">&lt;-</span> <span class="fu">file.path</span>(DATA_DIR, <span class="st">"2023_ntd_energy.xlsx"</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(NTD_ENERGY_FILE)){</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    DS <span class="ot">&lt;-</span> <span class="fu">download.file</span>(<span class="st">"https://www.transit.dot.gov/sites/fta.dot.gov/files/2024-10/2023%20Energy%20Consumption.xlsx"</span>, </span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>                        <span class="at">destfile=</span>NTD_ENERGY_FILE, </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>                        <span class="at">method=</span><span class="st">"curl"</span>)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(DS <span class="sc">|</span> (<span class="fu">file.info</span>(NTD_ENERGY_FILE)<span class="sc">$</span>size <span class="sc">==</span> <span class="dv">0</span>)){</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"I was unable to download the NTD Energy File. Please try again.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Download failed"</span>)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>NTD_ENERGY_RAW <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(NTD_ENERGY_FILE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in R1197 / R1197C18: got '-'</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(tidyr)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>to_numeric_fill_0 <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">replace_na</span>(<span class="fu">as.numeric</span>(x), <span class="dv">0</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>NTD_ENERGY <span class="ot">&lt;-</span> NTD_ENERGY_RAW <span class="sc">|&gt;</span> </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">`</span><span class="at">Reporter Type</span><span class="st">`</span>, <span class="st">`</span><span class="at">Reporting Module</span><span class="st">`</span>, <span class="st">`</span><span class="at">Other Fuel</span><span class="st">`</span>, <span class="st">`</span><span class="at">Other Fuel Description</span><span class="st">`</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">`</span><span class="at">Agency Name</span><span class="st">`</span>, <span class="st">`</span><span class="at">Mode</span><span class="st">`</span>, <span class="st">`</span><span class="at">TOS</span><span class="st">`</span>), to_numeric_fill_0)) <span class="sc">|&gt;</span> </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="st">`</span><span class="at">NTD ID</span><span class="st">`</span>, <span class="st">`</span><span class="at">Mode</span><span class="st">`</span>, <span class="st">`</span><span class="at">Agency Name</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), sum), <span class="at">.groups =</span> <span class="st">"keep"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ENERGY =</span> <span class="fu">sum</span>(<span class="fu">c_across</span>(<span class="fu">c</span>(<span class="fu">where</span>(is.numeric))))) <span class="sc">|&gt;</span> </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(ENERGY <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>ENERGY) <span class="sc">|&gt;</span> </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 7 warnings in `mutate()`.
The first warning was:
ℹ In argument: `across(-c(`Agency Name`, Mode, TOS), to_numeric_fill_0)`.
Caused by warning in `replace_na()`:
! NAs introduced by coercion
ℹ Run `dplyr::last_dplyr_warnings()` to see the 6 remaining warnings.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_sample</span>(NTD_ENERGY, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 16
   `NTD ID` Mode  `Agency Name`       `Bio-Diesel` `Bunker Fuel` `C Natural Gas`
      &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;                      &lt;dbl&gt;         &lt;dbl&gt;           &lt;dbl&gt;
 1    30054 VP    Centre Area Transp…            0             0               0
 2    50006 MB    City of Racine, Wi…            0             0               0
 3    20204 DR    Senior Citizens Un…            0             0               0
 4    50117 MB    Laketran                       0             0               0
 5    60103 DR    Fort Bend County, …            0             0               0
 6    60059 DR    Brazos Transit Dis…            0             0               0
 7    40224 DR    Buncombe County                0             0               0
 8    50092 DR    City of Rochester,…            0             0               0
 9    90142 MB    University of Cali…        22290             0          200432
10    20008 MB    MTA New York City …            0             0         4740687
# ℹ 10 more variables: `Diesel Fuel` &lt;dbl&gt;, `Electric Battery` &lt;dbl&gt;,
#   `Electric Propulsion` &lt;dbl&gt;, Ethanol &lt;dbl&gt;, Methonal &lt;dbl&gt;, Gasoline &lt;dbl&gt;,
#   Hydrogen &lt;dbl&gt;, Kerosene &lt;dbl&gt;, `Liquified Nat Gas` &lt;dbl&gt;,
#   `Liquified Petroleum Gas` &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="section" class="level3">
<h3 class="anchored" data-anchor-id="section"></h3>
</section>
</section>
<section id="task-3-recoding-the-mode-column" class="level2">
<h2 class="anchored" data-anchor-id="task-3-recoding-the-mode-column">Task 3: Recoding the Mode Column</h2>
<p>In this task, we focus on recoding the mode column in the National Transit Database (NTD) service data to provide more descriptive names.</p>
<section id="ntd-service-data" class="level3">
<h3 class="anchored" data-anchor-id="ntd-service-data">NTD Service Data:</h3>
<p>The National Transit Database contains information about transit agencies across the U.S., including details on service types, energy consumption, and passenger trips. The dataset requires cleaning and processing to make it suitable for analysis.</p>
<ol type="1">
<li><strong>Recoding Abbreviations:</strong>
<ul>
<li>Transit modes such as “HR” (Heavy Rail), “MB” (Motor Bus), and others were recoded to provide more meaningful names, improving the clarity of the dataset.</li>
</ul></li>
<li><strong>Service Data for 2023:</strong>
<ul>
<li>The script then downloads the 2023 NTD service data, including information about agencies, their service types, and passenger trip data. This data is cleaned and formatted for further analysis.</li>
</ul></li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure NTD_ENERGY dataset is available</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"NTD_ENERGY"</span>)){</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"NTD_ENERGY data is missing. Please run Task 2 first."</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">#  Identify Unique Mode Codes</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>unique_modes <span class="ot">&lt;-</span> NTD_ENERGY <span class="sc">|&gt;</span> <span class="fu">distinct</span>(Mode)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(unique_modes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 1
   Mode 
   &lt;chr&gt;
 1 DR   
 2 FB   
 3 MB   
 4 SR   
 5 TB   
 6 VP   
 7 CB   
 8 RB   
 9 LR   
10 MG   
11 CR   
12 AR   
13 TR   
14 HR   
15 YR   
16 IP   
17 PB   
18 CC   </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Recode the Mode Column</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>NTD_ENERGY <span class="ot">&lt;-</span> NTD_ENERGY <span class="sc">|&gt;</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Mode =</span> <span class="fu">case_when</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>        Mode <span class="sc">==</span> <span class="st">"HR"</span> <span class="sc">~</span> <span class="st">"Heavy Rail"</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>        Mode <span class="sc">==</span> <span class="st">"MB"</span> <span class="sc">~</span> <span class="st">"Motor Bus"</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>        Mode <span class="sc">==</span> <span class="st">"CR"</span> <span class="sc">~</span> <span class="st">"Commuter Rail"</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        Mode <span class="sc">==</span> <span class="st">"LR"</span> <span class="sc">~</span> <span class="st">"Light Rail"</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        Mode <span class="sc">==</span> <span class="st">"RB"</span> <span class="sc">~</span> <span class="st">"Rapid Bus"</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>        Mode <span class="sc">==</span> <span class="st">"TB"</span> <span class="sc">~</span> <span class="st">"Trolleybus"</span>,</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>        Mode <span class="sc">==</span> <span class="st">"CB"</span> <span class="sc">~</span> <span class="st">"Cable Car"</span>,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>        Mode <span class="sc">==</span> <span class="st">"TR"</span> <span class="sc">~</span> <span class="st">"Streetcar"</span>,</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>        Mode <span class="sc">==</span> <span class="st">"VP"</span> <span class="sc">~</span> <span class="st">"Vanpool"</span>,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>        Mode <span class="sc">==</span> <span class="st">"DR"</span> <span class="sc">~</span> <span class="st">"Demand Response"</span>,</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Unknown"</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify changes</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="fu">distinct</span>(NTD_ENERGY, Mode)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 1
   Mode           
   &lt;chr&gt;          
 1 Demand Response
 2 Unknown        
 3 Motor Bus      
 4 Trolleybus     
 5 Vanpool        
 6 Cable Car      
 7 Rapid Bus      
 8 Light Rail     
 9 Commuter Rail  
10 Streetcar      
11 Heavy Rail     </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Download the 2023 Service by Agency Data</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>DATA_DIR <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(DATA_DIR, <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>NTD_SERVICE_FILE <span class="ot">&lt;-</span> <span class="fu">file.path</span>(DATA_DIR, <span class="st">"2023_service.csv"</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(NTD_SERVICE_FILE)){</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    DS <span class="ot">&lt;-</span> <span class="fu">download.file</span>(<span class="st">"https://data.transportation.gov/resource/6y83-7vuw.csv"</span>, </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">destfile=</span>NTD_SERVICE_FILE, </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">method=</span><span class="st">"curl"</span>)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(DS <span class="sc">|</span> (<span class="fu">file.info</span>(NTD_SERVICE_FILE)<span class="sc">$</span>size <span class="sc">==</span> <span class="dv">0</span>)){</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"I was unable to download the NTD Service File. Please try again.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Download failed"</span>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required libraries</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the CSV file</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>NTD_SERVICE_RAW <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(NTD_SERVICE_FILE, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Check column names</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">names</span>(NTD_SERVICE_RAW))  <span class="co"># Identify correct column names</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "X_5_digit_ntd_id"                                  
 [2] "agency"                                            
 [3] "max_reporter_type"                                 
 [4] "max_organization_type"                             
 [5] "max_city"                                          
 [6] "max_state"                                         
 [7] "report_year"                                       
 [8] "max_agency_voms"                                   
 [9] "max_primary_uza_code"                              
[10] "max_primary_uza_name"                              
[11] "max_primary_uza_area_sq_miles"                     
[12] "max_primary_uza_population"                        
[13] "max_service_area_sq_miles"                         
[14] "max_service_area_population"                       
[15] "sum_actual_vehicles_passenger_car_miles"           
[16] "sum_actual_vehicles_passenger_car_revenue_miles"   
[17] "sum_actual_vehicles_passenger_deadhead_miles"      
[18] "sum_scheduled_vehicles_passenger_car_revenue_miles"
[19] "sum_actual_vehicles_passenger_car_hours"           
[20] "sum_actual_vehicles_passenger_car_revenue_hours"   
[21] "sum_actual_vehicles_passenger_car_deadhead_hours"  
[22] "sum_charter_service_hours"                         
[23] "sum_school_bus_hours"                              
[24] "sum_trains_in_operation"                           
[25] "sum_train_miles"                                   
[26] "sum_train_revenue_miles"                           
[27] "sum_train_deadhead_miles"                          
[28] "sum_train_hours"                                   
[29] "sum_train_revenue_hours"                           
[30] "sum_train_deadhead_hours"                          
[31] "sum_unlinked_passenger_trips_upt"                  
[32] "sum_ada_upt"                                       
[33] "sum_sponsored_service_upt"                         
[34] "sum_passenger_miles"                               
[35] "sum_directional_route_miles"                       </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If column names contain spaces or special characters, clean them</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(NTD_SERVICE_RAW) <span class="ot">&lt;-</span> <span class="fu">make.names</span>(<span class="fu">colnames</span>(NTD_SERVICE_RAW))</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print cleaned column names</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">names</span>(NTD_SERVICE_RAW))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "X_5_digit_ntd_id"                                  
 [2] "agency"                                            
 [3] "max_reporter_type"                                 
 [4] "max_organization_type"                             
 [5] "max_city"                                          
 [6] "max_state"                                         
 [7] "report_year"                                       
 [8] "max_agency_voms"                                   
 [9] "max_primary_uza_code"                              
[10] "max_primary_uza_name"                              
[11] "max_primary_uza_area_sq_miles"                     
[12] "max_primary_uza_population"                        
[13] "max_service_area_sq_miles"                         
[14] "max_service_area_population"                       
[15] "sum_actual_vehicles_passenger_car_miles"           
[16] "sum_actual_vehicles_passenger_car_revenue_miles"   
[17] "sum_actual_vehicles_passenger_deadhead_miles"      
[18] "sum_scheduled_vehicles_passenger_car_revenue_miles"
[19] "sum_actual_vehicles_passenger_car_hours"           
[20] "sum_actual_vehicles_passenger_car_revenue_hours"   
[21] "sum_actual_vehicles_passenger_car_deadhead_hours"  
[22] "sum_charter_service_hours"                         
[23] "sum_school_bus_hours"                              
[24] "sum_trains_in_operation"                           
[25] "sum_train_miles"                                   
[26] "sum_train_revenue_miles"                           
[27] "sum_train_deadhead_miles"                          
[28] "sum_train_hours"                                   
[29] "sum_train_revenue_hours"                           
[30] "sum_train_deadhead_hours"                          
[31] "sum_unlinked_passenger_trips_upt"                  
[32] "sum_ada_upt"                                       
[33] "sum_sponsored_service_upt"                         
[34] "sum_passenger_miles"                               
[35] "sum_directional_route_miles"                       </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for the correct column name that matches '_5_digit_ntd_id'</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>correct_col <span class="ot">&lt;-</span> <span class="fu">names</span>(NTD_SERVICE_RAW)[<span class="fu">grepl</span>(<span class="st">"ntd"</span>, <span class="fu">names</span>(NTD_SERVICE_RAW), <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Possible match for '_5_digit_ntd_id': {correct_col}"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Possible match for '_5_digit_ntd_id': X_5_digit_ntd_id</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the correct column name</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>NTD_SERVICE <span class="ot">&lt;-</span> NTD_SERVICE_RAW <span class="sc">|&gt;</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="st">`</span><span class="at">NTD ID</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">get</span>(correct_col[<span class="dv">1</span>]))) <span class="sc">|&gt;</span>  <span class="co"># Using dynamic column reference</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">Agency =</span> agency, </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">City   =</span> max_city, </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">State  =</span> max_state,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">UPT    =</span> sum_unlinked_passenger_trips_upt, </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">MILES  =</span> sum_passenger_miles) <span class="sc">|&gt;</span> </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"^[A-Z]"</span>, <span class="at">ignore.case=</span><span class="cn">FALSE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(MILES <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co"># View Cleaned Data</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(NTD_SERVICE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 302
Columns: 7
$ X_5_digit_ntd_id &lt;int&gt; 1, 2, 3, 5, 6, 7, 8, 11, 12, 16, 18, 19, 20, 21, 23, …
$ Agency           &lt;chr&gt; "King County, dba: King County Metro", "Spokane Trans…
$ City             &lt;chr&gt; "Seattle", "Spokane", "Lakewood", "Everett", "Yakima"…
$ State            &lt;chr&gt; "WA", "WA", "WA", "WA", "WA", "OR", "OR", "ID", "AK",…
$ UPT              &lt;dbl&gt; 78886848, 9403739, 6792245, 1404970, 646711, 6311613,…
$ MILES            &lt;dbl&gt; 301530502, 46318134, 40362320, 5193721, 3435365, 2277…
$ `NTD ID`         &lt;dbl&gt; 1, 2, 3, 5, 6, 7, 8, 11, 12, 16, 18, 19, 20, 21, 23, …</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="task-4-explore-ntd-service-data" class="level2">
<h2 class="anchored" data-anchor-id="task-4-explore-ntd-service-data">Task 4: Explore NTD Service Data</h2>
<p>This task focuses on analyzing the National Transit Database service data to identify patterns and trends.</p>
<section id="key-findings" class="level3">
<h3 class="anchored" data-anchor-id="key-findings">Key Findings:</h3>
<ol type="1">
<li><strong>Transit Service with the Most UPT (Unlinked Passenger Trips):</strong>
<ul>
<li>The transit agency with the highest number of Unlinked Passenger Trips (UPT) annually is identified. This helps determine the most utilized transit systems and their relative contribution to energy consumption and emissions.</li>
</ul></li>
<li><strong>Average Trip Length for MTA NYC:</strong>
<ul>
<li>The average trip length for <strong>MTA NYC Transit</strong> is computed. This metric is useful for understanding how far passengers typically travel on the system and can provide insights into the efficiency of operations.</li>
</ul></li>
<li><strong>Transit Service with the Longest Average Trip Length in NYC:</strong>
<ul>
<li>Among services in <strong>New York</strong> and <strong>Brooklyn</strong>, the service with the longest average trip length is identified. This could indicate long-haul operations, which tend to use more fuel and produce higher emissions.</li>
</ul></li>
<li><strong>State with the Fewest Total Miles Traveled by Public Transit:</strong>
<ul>
<li>The state with the lowest total miles traveled by public transit is identified. This suggests that transit systems in these states may be underdeveloped or underutilized.</li>
</ul></li>
<li><strong>Missing State Data:</strong>
<ul>
<li>States not represented in the dataset are identified to ensure comprehensive coverage. These gaps may indicate missing or incomplete data for certain regions.</li>
</ul></li>
<li><strong>Merging NTD Service Data with Energy Data:</strong>
<ul>
<li>The <strong>NTD_SERVICE</strong> dataset is merged with the <strong>NTD_ENERGY</strong> dataset to set up for a detailed emissions analysis. This step is crucial for calculating emissions based on the energy consumption of each agency.</li>
</ul></li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure NTD_SERVICE dataset is available</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"NTD_SERVICE"</span>)){</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"NTD_SERVICE data is missing. Please run Task 3 first."</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># View dataset structure</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(NTD_SERVICE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 302
Columns: 7
$ X_5_digit_ntd_id &lt;int&gt; 1, 2, 3, 5, 6, 7, 8, 11, 12, 16, 18, 19, 20, 21, 23, …
$ Agency           &lt;chr&gt; "King County, dba: King County Metro", "Spokane Trans…
$ City             &lt;chr&gt; "Seattle", "Spokane", "Lakewood", "Everett", "Yakima"…
$ State            &lt;chr&gt; "WA", "WA", "WA", "WA", "WA", "OR", "OR", "ID", "AK",…
$ UPT              &lt;dbl&gt; 78886848, 9403739, 6792245, 1404970, 646711, 6311613,…
$ MILES            &lt;dbl&gt; 301530502, 46318134, 40362320, 5193721, 3435365, 2277…
$ `NTD ID`         &lt;dbl&gt; 1, 2, 3, 5, 6, 7, 8, 11, 12, 16, 18, 19, 20, 21, 23, …</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Identify the Transit Service with the Most UPT Annually</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>most_upt_agency <span class="ot">&lt;-</span> NTD_SERVICE <span class="sc">|&gt;</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(UPT)) <span class="sc">|&gt;</span> </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Agency, State, UPT) <span class="sc">|&gt;</span> </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(most_upt_agency)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                     Agency State        UPT
1 MTA New York City Transit    NY 2632003044</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Calculate the Average Trip Length for MTA NYC</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>mta_nyc_trip_length <span class="ot">&lt;-</span> NTD_SERVICE <span class="sc">|&gt;</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Agency <span class="sc">==</span> <span class="st">"MTA NYC Transit"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">Average_Trip_Length =</span> <span class="fu">mean</span>(MILES <span class="sc">/</span> UPT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mta_nyc_trip_length)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Average_Trip_Length
1                 NaN</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Identify the NYC Transit Service with the Longest Average Trip Length</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>longest_trip_nyc <span class="ot">&lt;-</span> NTD_SERVICE <span class="sc">|&gt;</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(City <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"New York"</span>, <span class="st">"Brooklyn"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Average_Trip_Length =</span> MILES <span class="sc">/</span> UPT) <span class="sc">|&gt;</span> </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(Average_Trip_Length)) <span class="sc">|&gt;</span> </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Agency, City, Average_Trip_Length) <span class="sc">|&gt;</span> </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(longest_trip_nyc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                     Agency     City Average_Trip_Length
1 MTA Long Island Rail Road New York            24.25799</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Find the State with the Fewest Total Miles Traveled by Public Transit</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>fewest_miles_state <span class="ot">&lt;-</span> NTD_SERVICE <span class="sc">|&gt;</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(State) <span class="sc">|&gt;</span> </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">Total_Miles =</span> <span class="fu">sum</span>(MILES, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(Total_Miles) <span class="sc">|&gt;</span> </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fewest_miles_state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  State Total_Miles
  &lt;chr&gt;       &lt;dbl&gt;
1 NH        3749892</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Check for Missing States in the Dataset</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>all_states <span class="ot">&lt;-</span> state.name  <span class="co"># List of all U.S. states</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>states_in_data <span class="ot">&lt;-</span> <span class="fu">unique</span>(NTD_SERVICE<span class="sc">$</span>State)  <span class="co"># States in NTD_SERVICE dataset</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>missing_states <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(all_states, states_in_data)  <span class="co"># Find missing states</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_states)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Alabama"        "Alaska"         "Arizona"        "Arkansas"      
 [5] "California"     "Colorado"       "Connecticut"    "Delaware"      
 [9] "Florida"        "Georgia"        "Hawaii"         "Idaho"         
[13] "Illinois"       "Indiana"        "Iowa"           "Kansas"        
[17] "Kentucky"       "Louisiana"      "Maine"          "Maryland"      
[21] "Massachusetts"  "Michigan"       "Minnesota"      "Mississippi"   
[25] "Missouri"       "Montana"        "Nebraska"       "Nevada"        
[29] "New Hampshire"  "New Jersey"     "New Mexico"     "New York"      
[33] "North Carolina" "North Dakota"   "Ohio"           "Oklahoma"      
[37] "Oregon"         "Pennsylvania"   "Rhode Island"   "South Carolina"
[41] "South Dakota"   "Tennessee"      "Texas"          "Utah"          
[45] "Vermont"        "Virginia"       "Washington"     "West Virginia" 
[49] "Wisconsin"      "Wyoming"       </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Merge NTD_SERVICE with NTD_ENERGY to Prepare for Emissions Calculations</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>TRANSIT_DATA <span class="ot">&lt;-</span> NTD_SERVICE <span class="sc">|&gt;</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(NTD_ENERGY, <span class="at">by =</span> <span class="st">"NTD ID"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Agency))</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co"># View merged dataset</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(TRANSIT_DATA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 662
Columns: 22
$ X_5_digit_ntd_id          &lt;int&gt; 1, 1, 1, 1, 1, 1, 2, 2, 2, 3, 3, 3, 5, 5, 6,…
$ Agency                    &lt;chr&gt; "King County, dba: King County Metro", "King…
$ City                      &lt;chr&gt; "Seattle", "Seattle", "Seattle", "Seattle", …
$ State                     &lt;chr&gt; "WA", "WA", "WA", "WA", "WA", "WA", "WA", "W…
$ UPT                       &lt;dbl&gt; 78886848, 78886848, 78886848, 78886848, 7888…
$ MILES                     &lt;dbl&gt; 301530502, 301530502, 301530502, 301530502, …
$ `NTD ID`                  &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 2, 2, 2, 3, 3, 3, 5, 5, 6,…
$ Mode                      &lt;chr&gt; "Demand Response", "Unknown", "Motor Bus", "…
$ `Agency Name`             &lt;chr&gt; "King County", "King County", "King County",…
$ `Bio-Diesel`              &lt;dbl&gt; 0, 208441, 396458, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ `Bunker Fuel`             &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `C Natural Gas`           &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 16539, 1036567, 0…
$ `Diesel Fuel`             &lt;dbl&gt; 17880, 5591, 7049403, 0, 0, 0, 131642, 13355…
$ `Electric Battery`        &lt;dbl&gt; 0, 0, 2411807, 0, 0, 0, 0, 1202138, 0, 0, 26…
$ `Electric Propulsion`     &lt;dbl&gt; 0, 0, 0, 2122439, 13113330, 0, 0, 0, 0, 0, 0…
$ Ethanol                   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Methonal                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Gasoline                  &lt;dbl&gt; 940728, 0, 126689, 0, 0, 379932, 152360, 0, …
$ Hydrogen                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Kerosene                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `Liquified Nat Gas`       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `Liquified Petroleum Gas` &lt;dbl&gt; 292568, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="task-5-calculate-emissions" class="level2">
<h2 class="anchored" data-anchor-id="task-5-calculate-emissions">Task 5: Calculate Emissions</h2>
<p>This task involves calculating CO₂ emissions for each transit agency based on fuel types such as Diesel, Gasoline, CNG, LPG, and Electric propulsion.</p>
<section id="steps" class="level3">
<h3 class="anchored" data-anchor-id="steps">Steps:</h3>
<ol type="1">
<li><strong>Emissions Calculation:</strong>
<ul>
<li>CO₂ emissions are calculated for each transit agency using the appropriate emissions factors. For example, Diesel fuel has an emissions factor of 22.4 lbs per gallon.</li>
</ul></li>
<li><strong>Merging Datasets:</strong>
<ul>
<li>The <strong>NTD_SERVICE</strong>, <strong>NTD_ENERGY</strong>, and <strong>EIA_SEP_REPORT</strong> datasets are merged to enable emissions calculations based on fuel type and energy consumption.</li>
</ul></li>
<li><strong>Cleaning and Storing Results:</strong>
<ul>
<li>The resulting emissions dataset is cleaned, and a CSV file (<strong>Emissions_Analysis.csv</strong>) is created for further analysis.</li>
</ul></li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datasets)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure All Datasets Exist</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"NTD_SERVICE"</span>) <span class="sc">|</span> <span class="sc">!</span><span class="fu">exists</span>(<span class="st">"NTD_ENERGY"</span>) <span class="sc">|</span> <span class="sc">!</span><span class="fu">exists</span>(<span class="st">"EIA_SEP_REPORT"</span>)){</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"One or more datasets are missing. Please complete previous tasks first."</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="co"># View dataset structures</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(NTD_SERVICE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 302
Columns: 7
$ X_5_digit_ntd_id &lt;int&gt; 1, 2, 3, 5, 6, 7, 8, 11, 12, 16, 18, 19, 20, 21, 23, …
$ Agency           &lt;chr&gt; "King County, dba: King County Metro", "Spokane Trans…
$ City             &lt;chr&gt; "Seattle", "Spokane", "Lakewood", "Everett", "Yakima"…
$ State            &lt;chr&gt; "WA", "WA", "WA", "WA", "WA", "OR", "OR", "ID", "AK",…
$ UPT              &lt;dbl&gt; 78886848, 9403739, 6792245, 1404970, 646711, 6311613,…
$ MILES            &lt;dbl&gt; 301530502, 46318134, 40362320, 5193721, 3435365, 2277…
$ `NTD ID`         &lt;dbl&gt; 1, 2, 3, 5, 6, 7, 8, 11, 12, 16, 18, 19, 20, 21, 23, …</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(NTD_ENERGY)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,130
Columns: 16
$ `NTD ID`                  &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 2, 2, 2, 3, 3, 3, 5, 5, 6,…
$ Mode                      &lt;chr&gt; "Demand Response", "Unknown", "Motor Bus", "…
$ `Agency Name`             &lt;chr&gt; "King County", "King County", "King County",…
$ `Bio-Diesel`              &lt;dbl&gt; 0, 208441, 396458, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ `Bunker Fuel`             &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `C Natural Gas`           &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 16539, 1036567, 0…
$ `Diesel Fuel`             &lt;dbl&gt; 17880, 5591, 7049403, 0, 0, 0, 131642, 13355…
$ `Electric Battery`        &lt;dbl&gt; 0, 0, 2411807, 0, 0, 0, 0, 1202138, 0, 0, 26…
$ `Electric Propulsion`     &lt;dbl&gt; 0, 0, 0, 2122439, 13113330, 0, 0, 0, 0, 0, 0…
$ Ethanol                   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Methonal                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Gasoline                  &lt;dbl&gt; 940728, 0, 126689, 0, 0, 379932, 152360, 0, …
$ Hydrogen                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Kerosene                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `Liquified Nat Gas`       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `Liquified Petroleum Gas` &lt;dbl&gt; 292568, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(EIA_SEP_REPORT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 50
Columns: 6
$ CO2_MWh               &lt;dbl&gt; 727, 1180, 684, 987, 440, 1054, 576, 1095, 794, …
$ primary_source        &lt;chr&gt; "Natural gas", "Natural gas", "Natural gas", "Na…
$ electricity_price_MWh &lt;dbl&gt; 114.7, 214.1, 121.9, 97.3, 248.7, 117.6, 242.4, …
$ generation_MWh        &lt;dbl&gt; 139435010, 6717825, 111838736, 63195647, 2166287…
$ state                 &lt;chr&gt; "Alabama", "Alaska", "Arizona", "Arkansas", "Cal…
$ abbreviation          &lt;chr&gt; "AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", …</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Fix `State` Column in `EIA_SEP_REPORT`</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Check column names before renaming</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(EIA_SEP_REPORT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "CO2_MWh"               "primary_source"        "electricity_price_MWh"
[4] "generation_MWh"        "state"                 "abbreviation"         </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename 'state' to 'State' if needed</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="st">"state"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(EIA_SEP_REPORT)) {</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    EIA_SEP_REPORT <span class="ot">&lt;-</span> EIA_SEP_REPORT <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">State =</span> state)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(<span class="st">"STATE"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(EIA_SEP_REPORT)) {</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    EIA_SEP_REPORT <span class="ot">&lt;-</span> EIA_SEP_REPORT <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">State =</span> STATE)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify column names after renaming</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(EIA_SEP_REPORT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "CO2_MWh"               "primary_source"        "electricity_price_MWh"
[4] "generation_MWh"        "State"                 "abbreviation"         </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Standardize the `State` Column Using Abbreviations</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>state_mapping <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">State =</span> state.name,  </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">State_Abbr =</span> state.abb  </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge state abbreviations</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>EIA_SEP_REPORT <span class="ot">&lt;-</span> EIA_SEP_REPORT <span class="sc">|&gt;</span> </span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(state_mapping, <span class="at">by =</span> <span class="st">"State"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">State =</span> State_Abbr) <span class="sc">|&gt;</span> </span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>State_Abbr)</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="co">#  Join the Three Datasets</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>EMISSIONS_DATA <span class="ot">&lt;-</span> NTD_SERVICE <span class="sc">|&gt;</span> </span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(NTD_ENERGY, <span class="at">by =</span> <span class="st">"NTD ID"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(EIA_SEP_REPORT, <span class="at">by =</span> <span class="st">"State"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Agency))  <span class="co"># Remove missing agency entries</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a><span class="co"># View structure of the merged dataset</span></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(EMISSIONS_DATA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 662
Columns: 27
$ X_5_digit_ntd_id          &lt;int&gt; 1, 1, 1, 1, 1, 1, 2, 2, 2, 3, 3, 3, 5, 5, 6,…
$ Agency                    &lt;chr&gt; "King County, dba: King County Metro", "King…
$ City                      &lt;chr&gt; "Seattle", "Seattle", "Seattle", "Seattle", …
$ State                     &lt;chr&gt; "WA", "WA", "WA", "WA", "WA", "WA", "WA", "W…
$ UPT                       &lt;dbl&gt; 78886848, 78886848, 78886848, 78886848, 7888…
$ MILES                     &lt;dbl&gt; 301530502, 301530502, 301530502, 301530502, …
$ `NTD ID`                  &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 2, 2, 2, 3, 3, 3, 5, 5, 6,…
$ Mode                      &lt;chr&gt; "Demand Response", "Unknown", "Motor Bus", "…
$ `Agency Name`             &lt;chr&gt; "King County", "King County", "King County",…
$ `Bio-Diesel`              &lt;dbl&gt; 0, 208441, 396458, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ `Bunker Fuel`             &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `C Natural Gas`           &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 16539, 1036567, 0…
$ `Diesel Fuel`             &lt;dbl&gt; 17880, 5591, 7049403, 0, 0, 0, 131642, 13355…
$ `Electric Battery`        &lt;dbl&gt; 0, 0, 2411807, 0, 0, 0, 0, 1202138, 0, 0, 26…
$ `Electric Propulsion`     &lt;dbl&gt; 0, 0, 0, 2122439, 13113330, 0, 0, 0, 0, 0, 0…
$ Ethanol                   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Methonal                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Gasoline                  &lt;dbl&gt; 940728, 0, 126689, 0, 0, 379932, 152360, 0, …
$ Hydrogen                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Kerosene                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `Liquified Nat Gas`       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `Liquified Petroleum Gas` &lt;dbl&gt; 292568, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ CO2_MWh                   &lt;dbl&gt; 292, 292, 292, 292, 292, 292, 292, 292, 292,…
$ primary_source            &lt;chr&gt; "Hydroelectric", "Hydroelectric", "Hydroelec…
$ electricity_price_MWh     &lt;dbl&gt; 95.8, 95.8, 95.8, 95.8, 95.8, 95.8, 95.8, 95…
$ generation_MWh            &lt;dbl&gt; 102960605, 102960605, 102960605, 102960605, …
$ abbreviation              &lt;chr&gt; "WA", "WA", "WA", "WA", "WA", "WA", "WA", "W…</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Define CO₂ Emission Factors (lbs per gallon or per MWh)</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>CO2_FACTORS <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Diesel Fuel"</span> <span class="ot">=</span> <span class="fl">22.4</span>,  </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Gasoline"</span> <span class="ot">=</span> <span class="fl">19.6</span>, </span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"C Natural Gas"</span> <span class="ot">=</span> <span class="fl">11.7</span>,  </span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Liquified Petroleum Gas"</span> <span class="ot">=</span> <span class="fl">12.7</span>,  </span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Bunker Fuel"</span> <span class="ot">=</span> <span class="fl">26.0</span>,  </span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Ethanol"</span> <span class="ot">=</span> <span class="fl">12.5</span>,  </span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Electric Propulsion"</span> <span class="ot">=</span> <span class="cn">NA</span>  </span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="co">#  Compute Total Emissions for Each Transit Agency</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>EMISSIONS_DATA <span class="ot">&lt;-</span> EMISSIONS_DATA <span class="sc">|&gt;</span> </span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">Diesel_Emissions =</span> <span class="st">`</span><span class="at">Diesel Fuel</span><span class="st">`</span> <span class="sc">*</span> CO2_FACTORS[[<span class="st">"Diesel Fuel"</span>]],</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">Gasoline_Emissions =</span> Gasoline <span class="sc">*</span> CO2_FACTORS[[<span class="st">"Gasoline"</span>]],</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">CNG_Emissions =</span> <span class="st">`</span><span class="at">C Natural Gas</span><span class="st">`</span> <span class="sc">*</span> CO2_FACTORS[[<span class="st">"C Natural Gas"</span>]],</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">LPG_Emissions =</span> <span class="st">`</span><span class="at">Liquified Petroleum Gas</span><span class="st">`</span> <span class="sc">*</span> CO2_FACTORS[[<span class="st">"Liquified Petroleum Gas"</span>]],</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">Bunker_Emissions =</span> <span class="st">`</span><span class="at">Bunker Fuel</span><span class="st">`</span> <span class="sc">*</span> CO2_FACTORS[[<span class="st">"Bunker Fuel"</span>]],</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">Ethanol_Emissions =</span> Ethanol <span class="sc">*</span> CO2_FACTORS[[<span class="st">"Ethanol"</span>]],</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">Electric_Emissions =</span> <span class="st">`</span><span class="at">Electric Propulsion</span><span class="st">`</span> <span class="sc">*</span> CO2_MWh,  </span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">Total_Emissions =</span> <span class="fu">rowSums</span>(<span class="fu">across</span>(<span class="fu">ends_with</span>(<span class="st">"Emissions"</span>)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a><span class="co"># View emissions summary</span></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(EMISSIONS_DATA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 662
Columns: 35
$ X_5_digit_ntd_id          &lt;int&gt; 1, 1, 1, 1, 1, 1, 2, 2, 2, 3, 3, 3, 5, 5, 6,…
$ Agency                    &lt;chr&gt; "King County, dba: King County Metro", "King…
$ City                      &lt;chr&gt; "Seattle", "Seattle", "Seattle", "Seattle", …
$ State                     &lt;chr&gt; "WA", "WA", "WA", "WA", "WA", "WA", "WA", "W…
$ UPT                       &lt;dbl&gt; 78886848, 78886848, 78886848, 78886848, 7888…
$ MILES                     &lt;dbl&gt; 301530502, 301530502, 301530502, 301530502, …
$ `NTD ID`                  &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 2, 2, 2, 3, 3, 3, 5, 5, 6,…
$ Mode                      &lt;chr&gt; "Demand Response", "Unknown", "Motor Bus", "…
$ `Agency Name`             &lt;chr&gt; "King County", "King County", "King County",…
$ `Bio-Diesel`              &lt;dbl&gt; 0, 208441, 396458, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ `Bunker Fuel`             &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `C Natural Gas`           &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 16539, 1036567, 0…
$ `Diesel Fuel`             &lt;dbl&gt; 17880, 5591, 7049403, 0, 0, 0, 131642, 13355…
$ `Electric Battery`        &lt;dbl&gt; 0, 0, 2411807, 0, 0, 0, 0, 1202138, 0, 0, 26…
$ `Electric Propulsion`     &lt;dbl&gt; 0, 0, 0, 2122439, 13113330, 0, 0, 0, 0, 0, 0…
$ Ethanol                   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Methonal                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Gasoline                  &lt;dbl&gt; 940728, 0, 126689, 0, 0, 379932, 152360, 0, …
$ Hydrogen                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Kerosene                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `Liquified Nat Gas`       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `Liquified Petroleum Gas` &lt;dbl&gt; 292568, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ CO2_MWh                   &lt;dbl&gt; 292, 292, 292, 292, 292, 292, 292, 292, 292,…
$ primary_source            &lt;chr&gt; "Hydroelectric", "Hydroelectric", "Hydroelec…
$ electricity_price_MWh     &lt;dbl&gt; 95.8, 95.8, 95.8, 95.8, 95.8, 95.8, 95.8, 95…
$ generation_MWh            &lt;dbl&gt; 102960605, 102960605, 102960605, 102960605, …
$ abbreviation              &lt;chr&gt; "WA", "WA", "WA", "WA", "WA", "WA", "WA", "W…
$ Diesel_Emissions          &lt;dbl&gt; 400512.0, 125238.4, 157906627.2, 0.0, 0.0, 0…
$ Gasoline_Emissions        &lt;dbl&gt; 18438268.8, 0.0, 2483104.4, 0.0, 0.0, 744666…
$ CNG_Emissions             &lt;dbl&gt; 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,…
$ LPG_Emissions             &lt;dbl&gt; 3715614, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Bunker_Emissions          &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Ethanol_Emissions         &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Electric_Emissions        &lt;dbl&gt; 0, 0, 0, 619752188, 3829092360, 0, 0, 0, 0, …
$ Total_Emissions           &lt;dbl&gt; 2.255439e+07, 1.252384e+05, 1.603897e+08, 6.…</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Normalize Emissions (per UPT and per Mile)</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>EMISSIONS_DATA <span class="ot">&lt;-</span> EMISSIONS_DATA <span class="sc">|&gt;</span> </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">Emissions_per_UPT =</span> Total_Emissions <span class="sc">/</span> UPT,</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">Emissions_per_Mile =</span> Total_Emissions <span class="sc">/</span> MILES</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="co"># View final emissions dataset</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(EMISSIONS_DATA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 662
Columns: 37
$ X_5_digit_ntd_id          &lt;int&gt; 1, 1, 1, 1, 1, 1, 2, 2, 2, 3, 3, 3, 5, 5, 6,…
$ Agency                    &lt;chr&gt; "King County, dba: King County Metro", "King…
$ City                      &lt;chr&gt; "Seattle", "Seattle", "Seattle", "Seattle", …
$ State                     &lt;chr&gt; "WA", "WA", "WA", "WA", "WA", "WA", "WA", "W…
$ UPT                       &lt;dbl&gt; 78886848, 78886848, 78886848, 78886848, 7888…
$ MILES                     &lt;dbl&gt; 301530502, 301530502, 301530502, 301530502, …
$ `NTD ID`                  &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 2, 2, 2, 3, 3, 3, 5, 5, 6,…
$ Mode                      &lt;chr&gt; "Demand Response", "Unknown", "Motor Bus", "…
$ `Agency Name`             &lt;chr&gt; "King County", "King County", "King County",…
$ `Bio-Diesel`              &lt;dbl&gt; 0, 208441, 396458, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ `Bunker Fuel`             &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `C Natural Gas`           &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 16539, 1036567, 0…
$ `Diesel Fuel`             &lt;dbl&gt; 17880, 5591, 7049403, 0, 0, 0, 131642, 13355…
$ `Electric Battery`        &lt;dbl&gt; 0, 0, 2411807, 0, 0, 0, 0, 1202138, 0, 0, 26…
$ `Electric Propulsion`     &lt;dbl&gt; 0, 0, 0, 2122439, 13113330, 0, 0, 0, 0, 0, 0…
$ Ethanol                   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Methonal                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Gasoline                  &lt;dbl&gt; 940728, 0, 126689, 0, 0, 379932, 152360, 0, …
$ Hydrogen                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Kerosene                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `Liquified Nat Gas`       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `Liquified Petroleum Gas` &lt;dbl&gt; 292568, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ CO2_MWh                   &lt;dbl&gt; 292, 292, 292, 292, 292, 292, 292, 292, 292,…
$ primary_source            &lt;chr&gt; "Hydroelectric", "Hydroelectric", "Hydroelec…
$ electricity_price_MWh     &lt;dbl&gt; 95.8, 95.8, 95.8, 95.8, 95.8, 95.8, 95.8, 95…
$ generation_MWh            &lt;dbl&gt; 102960605, 102960605, 102960605, 102960605, …
$ abbreviation              &lt;chr&gt; "WA", "WA", "WA", "WA", "WA", "WA", "WA", "W…
$ Diesel_Emissions          &lt;dbl&gt; 400512.0, 125238.4, 157906627.2, 0.0, 0.0, 0…
$ Gasoline_Emissions        &lt;dbl&gt; 18438268.8, 0.0, 2483104.4, 0.0, 0.0, 744666…
$ CNG_Emissions             &lt;dbl&gt; 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,…
$ LPG_Emissions             &lt;dbl&gt; 3715614, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Bunker_Emissions          &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Ethanol_Emissions         &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Electric_Emissions        &lt;dbl&gt; 0, 0, 0, 619752188, 3829092360, 0, 0, 0, 0, …
$ Total_Emissions           &lt;dbl&gt; 2.255439e+07, 1.252384e+05, 1.603897e+08, 6.…
$ Emissions_per_UPT         &lt;dbl&gt; 0.28590817, 0.00158757, 2.03316187, 7.856216…
$ Emissions_per_Mile        &lt;dbl&gt; 7.479971e-02, 4.153424e-04, 5.319188e-01, 2.…</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the dataset to CSV for further analysis</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(EMISSIONS_DATA, <span class="st">"Emissions_Analysis.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
</section>
</section>
<section id="task-6-normalize-emissions-to-transit-usage" class="level2">
<h2 class="anchored" data-anchor-id="task-6-normalize-emissions-to-transit-usage">Task 6: Normalize Emissions to Transit Usage</h2>
<p>Normalization of emissions is done to compare the environmental performance of transit agencies based on their usage patterns.</p>
<section id="key-findings-1" class="level3">
<h3 class="anchored" data-anchor-id="key-findings-1">Key Findings:</h3>
<ol type="1">
<li><strong>Normalization per UPT and per Mile:</strong>
<ul>
<li>Emissions are normalized per Unlinked Passenger Trip (UPT) and per mile to provide a fair comparison between agencies of different sizes.</li>
</ul></li>
<li><strong>Categorizing Agencies by Size:</strong>
<ul>
<li>Agencies are categorized as <strong>Small</strong>, <strong>Medium</strong>, or <strong>Large</strong> based on their UPT, allowing for comparisons between agencies of similar sizes.</li>
</ul></li>
<li><strong>Greenest Transit Agency:</strong>
<ul>
<li>The agency with the lowest emissions per mile is identified as the greenest transit agency, showcasing the most efficient operations.</li>
</ul></li>
<li><strong>Emissions Avoided:</strong>
<ul>
<li>The emissions avoided by using public transit instead of private cars are calculated. This is based on the assumption that private cars emit 19.6 lbs CO₂ per gallon of fuel, and transit systems can help reduce this footprint.</li>
</ul></li>
<li><strong>Best Electrified Agency:</strong>
<ul>
<li>The agency with the highest percentage of electric propulsion is recognized as the best electrified transit agency, contributing to the overall reduction in greenhouse gas emissions.</li>
</ul></li>
<li><strong>Worst Polluter:</strong>
<ul>
<li>The agency with the highest emissions per mile is identified as the worst polluter. This agency represents an area where improvements in efficiency and electrification could lead to significant environmental benefits.</li>
</ul></li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install and load required packages</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages(c("dplyr", "tidyverse", "scales"))</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'kableExtra'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    group_rows</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Ensure the emissions dataset exists</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"EMISSIONS_DATA"</span>)){</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"EMISSIONS_DATA is missing. Please run Task 5 first."</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="co"># View dataset structure</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(EMISSIONS_DATA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 662
Columns: 37
$ X_5_digit_ntd_id          &lt;int&gt; 1, 1, 1, 1, 1, 1, 2, 2, 2, 3, 3, 3, 5, 5, 6,…
$ Agency                    &lt;chr&gt; "King County, dba: King County Metro", "King…
$ City                      &lt;chr&gt; "Seattle", "Seattle", "Seattle", "Seattle", …
$ State                     &lt;chr&gt; "WA", "WA", "WA", "WA", "WA", "WA", "WA", "W…
$ UPT                       &lt;dbl&gt; 78886848, 78886848, 78886848, 78886848, 7888…
$ MILES                     &lt;dbl&gt; 301530502, 301530502, 301530502, 301530502, …
$ `NTD ID`                  &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 2, 2, 2, 3, 3, 3, 5, 5, 6,…
$ Mode                      &lt;chr&gt; "Demand Response", "Unknown", "Motor Bus", "…
$ `Agency Name`             &lt;chr&gt; "King County", "King County", "King County",…
$ `Bio-Diesel`              &lt;dbl&gt; 0, 208441, 396458, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ `Bunker Fuel`             &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `C Natural Gas`           &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 16539, 1036567, 0…
$ `Diesel Fuel`             &lt;dbl&gt; 17880, 5591, 7049403, 0, 0, 0, 131642, 13355…
$ `Electric Battery`        &lt;dbl&gt; 0, 0, 2411807, 0, 0, 0, 0, 1202138, 0, 0, 26…
$ `Electric Propulsion`     &lt;dbl&gt; 0, 0, 0, 2122439, 13113330, 0, 0, 0, 0, 0, 0…
$ Ethanol                   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Methonal                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Gasoline                  &lt;dbl&gt; 940728, 0, 126689, 0, 0, 379932, 152360, 0, …
$ Hydrogen                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Kerosene                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `Liquified Nat Gas`       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `Liquified Petroleum Gas` &lt;dbl&gt; 292568, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ CO2_MWh                   &lt;dbl&gt; 292, 292, 292, 292, 292, 292, 292, 292, 292,…
$ primary_source            &lt;chr&gt; "Hydroelectric", "Hydroelectric", "Hydroelec…
$ electricity_price_MWh     &lt;dbl&gt; 95.8, 95.8, 95.8, 95.8, 95.8, 95.8, 95.8, 95…
$ generation_MWh            &lt;dbl&gt; 102960605, 102960605, 102960605, 102960605, …
$ abbreviation              &lt;chr&gt; "WA", "WA", "WA", "WA", "WA", "WA", "WA", "W…
$ Diesel_Emissions          &lt;dbl&gt; 400512.0, 125238.4, 157906627.2, 0.0, 0.0, 0…
$ Gasoline_Emissions        &lt;dbl&gt; 18438268.8, 0.0, 2483104.4, 0.0, 0.0, 744666…
$ CNG_Emissions             &lt;dbl&gt; 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,…
$ LPG_Emissions             &lt;dbl&gt; 3715614, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Bunker_Emissions          &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Ethanol_Emissions         &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Electric_Emissions        &lt;dbl&gt; 0, 0, 0, 619752188, 3829092360, 0, 0, 0, 0, …
$ Total_Emissions           &lt;dbl&gt; 2.255439e+07, 1.252384e+05, 1.603897e+08, 6.…
$ Emissions_per_UPT         &lt;dbl&gt; 0.28590817, 0.00158757, 2.03316187, 7.856216…
$ Emissions_per_Mile        &lt;dbl&gt; 7.479971e-02, 4.153424e-04, 5.319188e-01, 2.…</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Normalize Emissions Per UPT and Per Passenger Mile</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>EMISSIONS_DATA <span class="ot">&lt;-</span> EMISSIONS_DATA <span class="sc">|&gt;</span> </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">Emissions_per_UPT =</span> Total_Emissions <span class="sc">/</span> UPT,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">Emissions_per_Mile =</span> Total_Emissions <span class="sc">/</span> MILES</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Emissions_per_UPT), <span class="sc">!</span><span class="fu">is.na</span>(Emissions_per_Mile))  <span class="co"># Remove NAs</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="co"># View the updated dataset</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(EMISSIONS_DATA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 662
Columns: 37
$ X_5_digit_ntd_id          &lt;int&gt; 1, 1, 1, 1, 1, 1, 2, 2, 2, 3, 3, 3, 5, 5, 6,…
$ Agency                    &lt;chr&gt; "King County, dba: King County Metro", "King…
$ City                      &lt;chr&gt; "Seattle", "Seattle", "Seattle", "Seattle", …
$ State                     &lt;chr&gt; "WA", "WA", "WA", "WA", "WA", "WA", "WA", "W…
$ UPT                       &lt;dbl&gt; 78886848, 78886848, 78886848, 78886848, 7888…
$ MILES                     &lt;dbl&gt; 301530502, 301530502, 301530502, 301530502, …
$ `NTD ID`                  &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 2, 2, 2, 3, 3, 3, 5, 5, 6,…
$ Mode                      &lt;chr&gt; "Demand Response", "Unknown", "Motor Bus", "…
$ `Agency Name`             &lt;chr&gt; "King County", "King County", "King County",…
$ `Bio-Diesel`              &lt;dbl&gt; 0, 208441, 396458, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ `Bunker Fuel`             &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `C Natural Gas`           &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 16539, 1036567, 0…
$ `Diesel Fuel`             &lt;dbl&gt; 17880, 5591, 7049403, 0, 0, 0, 131642, 13355…
$ `Electric Battery`        &lt;dbl&gt; 0, 0, 2411807, 0, 0, 0, 0, 1202138, 0, 0, 26…
$ `Electric Propulsion`     &lt;dbl&gt; 0, 0, 0, 2122439, 13113330, 0, 0, 0, 0, 0, 0…
$ Ethanol                   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Methonal                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Gasoline                  &lt;dbl&gt; 940728, 0, 126689, 0, 0, 379932, 152360, 0, …
$ Hydrogen                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Kerosene                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `Liquified Nat Gas`       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `Liquified Petroleum Gas` &lt;dbl&gt; 292568, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ CO2_MWh                   &lt;dbl&gt; 292, 292, 292, 292, 292, 292, 292, 292, 292,…
$ primary_source            &lt;chr&gt; "Hydroelectric", "Hydroelectric", "Hydroelec…
$ electricity_price_MWh     &lt;dbl&gt; 95.8, 95.8, 95.8, 95.8, 95.8, 95.8, 95.8, 95…
$ generation_MWh            &lt;dbl&gt; 102960605, 102960605, 102960605, 102960605, …
$ abbreviation              &lt;chr&gt; "WA", "WA", "WA", "WA", "WA", "WA", "WA", "W…
$ Diesel_Emissions          &lt;dbl&gt; 400512.0, 125238.4, 157906627.2, 0.0, 0.0, 0…
$ Gasoline_Emissions        &lt;dbl&gt; 18438268.8, 0.0, 2483104.4, 0.0, 0.0, 744666…
$ CNG_Emissions             &lt;dbl&gt; 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,…
$ LPG_Emissions             &lt;dbl&gt; 3715614, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Bunker_Emissions          &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Ethanol_Emissions         &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Electric_Emissions        &lt;dbl&gt; 0, 0, 0, 619752188, 3829092360, 0, 0, 0, 0, …
$ Total_Emissions           &lt;dbl&gt; 2.255439e+07, 1.252384e+05, 1.603897e+08, 6.…
$ Emissions_per_UPT         &lt;dbl&gt; 0.28590817, 0.00158757, 2.03316187, 7.856216…
$ Emissions_per_Mile        &lt;dbl&gt; 7.479971e-02, 4.153424e-04, 5.319188e-01, 2.…</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Categorize Agencies by Size (Small, Medium, Large)</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>EMISSIONS_DATA <span class="ot">&lt;-</span> EMISSIONS_DATA <span class="sc">|&gt;</span> </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">Agency_Size =</span> <span class="fu">case_when</span>(</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>            UPT <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">6</span> <span class="sc">~</span> <span class="st">"Small"</span>,</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>            UPT <span class="sc">&gt;=</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">6</span> <span class="sc">&amp;</span> UPT <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">8</span> <span class="sc">~</span> <span class="st">"Medium"</span>,</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>            UPT <span class="sc">&gt;=</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">8</span> <span class="sc">~</span> <span class="st">"Large"</span>,</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Unknown"</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="co"># View distribution of agency sizes</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(EMISSIONS_DATA<span class="sc">$</span>Agency_Size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Large Medium  Small 
    30    381    251 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Identify Greenest Transit Agencies (Awards)</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  Greenest Transit Agency (Lowest Emissions per Mile)</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>greenest_agency <span class="ot">&lt;-</span> EMISSIONS_DATA <span class="sc">|&gt;</span> </span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(Emissions_per_Mile) <span class="sc">|&gt;</span> </span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(greenest_agency, <span class="at">format =</span> <span class="st">"pipe"</span>, <span class="at">caption =</span> <span class="st">"The agency with the lowest emissions per mile."</span>) <span class="sc">|&gt;</span> </span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>The agency with the lowest emissions per mile.</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">X_5_digit_ntd_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Agency</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">City</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">State</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">UPT</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MILES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">NTD ID</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Mode</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Agency Name</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Bio-Diesel</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Bunker Fuel</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">C Natural Gas</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Diesel Fuel</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Electric Battery</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Electric Propulsion</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Ethanol</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Methonal</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Gasoline</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Hydrogen</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Kerosene</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Liquified Nat Gas</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Liquified Petroleum Gas</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CO2_MWh</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">primary_source</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">electricity_price_MWh</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">generation_MWh</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">abbreviation</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Diesel_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Gasoline_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CNG_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LPG_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Bunker_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Ethanol_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Electric_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Total_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Emissions_per_UPT</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Emissions_per_Mile</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Agency_Size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: left;">Lane Transit District</td>
<td style="text-align: left;">Eugene</td>
<td style="text-align: left;">OR</td>
<td style="text-align: right;">6311613</td>
<td style="text-align: right;">22779952</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">Rapid Bus</td>
<td style="text-align: left;">Lane Transit District</td>
<td style="text-align: right;">212371</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">344</td>
<td style="text-align: left;">Hydroelectric</td>
<td style="text-align: right;">103.2</td>
<td style="text-align: right;">61691869</td>
<td style="text-align: left;">OR</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Medium</td>
</tr>
</tbody>
</table>


</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Most Emissions Avoided (Comparison with Private Cars)</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume 25 miles per gallon (MPG) for private vehicles and 19.6 lbs CO₂ per gallon of gasoline.</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>MPG <span class="ot">&lt;-</span> <span class="dv">25</span>  </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>CO2_per_gallon <span class="ot">&lt;-</span> <span class="fl">19.6</span>  </span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute emissions if passengers used cars instead</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>EMISSIONS_DATA <span class="ot">&lt;-</span> EMISSIONS_DATA <span class="sc">|&gt;</span> </span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">Car_Emissions =</span> (MILES <span class="sc">/</span> MPG) <span class="sc">*</span> CO2_per_gallon,</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">Emissions_Avoided =</span> Car_Emissions <span class="sc">-</span> Total_Emissions</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify the agency that avoided the most emissions</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>most_emissions_avoided <span class="ot">&lt;-</span> EMISSIONS_DATA <span class="sc">|&gt;</span> </span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(Emissions_Avoided)) <span class="sc">|&gt;</span> </span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(most_emissions_avoided, <span class="at">format =</span> <span class="st">"pipe"</span>, <span class="at">caption =</span> <span class="st">"The agency that avoided the most CO₂ emissions compared to private vehicle travel."</span>) <span class="sc">|&gt;</span> </span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>The agency that avoided the most CO₂ emissions compared to private vehicle travel.</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">X_5_digit_ntd_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Agency</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">City</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">State</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">UPT</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MILES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">NTD ID</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Mode</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Agency Name</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Bio-Diesel</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Bunker Fuel</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">C Natural Gas</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Diesel Fuel</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Electric Battery</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Electric Propulsion</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Ethanol</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Methonal</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Gasoline</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Hydrogen</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Kerosene</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Liquified Nat Gas</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Liquified Petroleum Gas</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CO2_MWh</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">primary_source</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">electricity_price_MWh</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">generation_MWh</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">abbreviation</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Diesel_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Gasoline_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CNG_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LPG_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Bunker_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Ethanol_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Electric_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Total_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Emissions_per_UPT</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Emissions_per_Mile</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Agency_Size</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Car_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Emissions_Avoided</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">20008</td>
<td style="text-align: left;">MTA New York City Transit</td>
<td style="text-align: left;">Brooklyn</td>
<td style="text-align: left;">NY</td>
<td style="text-align: right;">2632003044</td>
<td style="text-align: right;">9591253658</td>
<td style="text-align: right;">20008</td>
<td style="text-align: left;">Rapid Bus</td>
<td style="text-align: left;">MTA New York City Transit</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1085753</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">522</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: right;">182.8</td>
<td style="text-align: right;">124039988</td>
<td style="text-align: left;">NY</td>
<td style="text-align: right;">24320867</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">24320867</td>
<td style="text-align: right;">0.0092404</td>
<td style="text-align: right;">0.0025357</td>
<td style="text-align: left;">Large</td>
<td style="text-align: right;">7519542868</td>
<td style="text-align: right;">7495222001</td>
</tr>
</tbody>
</table>


</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Best Electrified Agency (Highest % Electric Propulsion)</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>best_electric_agency <span class="ot">&lt;-</span> EMISSIONS_DATA <span class="sc">|&gt;</span> </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Electric_Percentage =</span> <span class="st">`</span><span class="at">Electric Propulsion</span><span class="st">`</span> <span class="sc">/</span> (<span class="fu">rowSums</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"Fuel"</span>)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(Electric_Percentage)) <span class="sc">|&gt;</span> </span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(best_electric_agency, <span class="at">format =</span> <span class="st">"pipe"</span>, <span class="at">caption =</span> <span class="st">"The agency with the highest percentage of electric propulsion usage."</span>) <span class="sc">|&gt;</span> </span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>The agency with the highest percentage of electric propulsion usage.</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">X_5_digit_ntd_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Agency</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">City</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">State</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">UPT</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MILES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">NTD ID</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Mode</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Agency Name</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Bio-Diesel</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Bunker Fuel</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">C Natural Gas</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Diesel Fuel</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Electric Battery</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Electric Propulsion</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Ethanol</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Methonal</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Gasoline</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Hydrogen</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Kerosene</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Liquified Nat Gas</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Liquified Petroleum Gas</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CO2_MWh</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">primary_source</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">electricity_price_MWh</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">generation_MWh</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">abbreviation</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Diesel_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Gasoline_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CNG_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LPG_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Bunker_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Ethanol_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Electric_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Total_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Emissions_per_UPT</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Emissions_per_Mile</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Agency_Size</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Car_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Emissions_Avoided</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Electric_Percentage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">King County, dba: King County Metro</td>
<td style="text-align: left;">Seattle</td>
<td style="text-align: left;">WA</td>
<td style="text-align: right;">78886848</td>
<td style="text-align: right;">301530502</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">King County</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2122439</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">292</td>
<td style="text-align: left;">Hydroelectric</td>
<td style="text-align: right;">95.8</td>
<td style="text-align: right;">102960605</td>
<td style="text-align: left;">WA</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">619752188</td>
<td style="text-align: right;">619752188</td>
<td style="text-align: right;">7.856217</td>
<td style="text-align: right;">2.055355</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">236399914</td>
<td style="text-align: right;">-383352274</td>
<td style="text-align: right;">Inf</td>
</tr>
</tbody>
</table>


</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Worst Polluter (Highest Emissions per Mile)</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>worst_polluter <span class="ot">&lt;-</span> EMISSIONS_DATA <span class="sc">|&gt;</span> </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(Emissions_per_Mile)) <span class="sc">|&gt;</span> </span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(worst_polluter, <span class="at">format =</span> <span class="st">"pipe"</span>, <span class="at">caption =</span> <span class="st">"The agency with the highest CO₂ emissions per mile."</span>) <span class="sc">|&gt;</span> </span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>The agency with the highest CO₂ emissions per mile.</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">X_5_digit_ntd_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Agency</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">City</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">State</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">UPT</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MILES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">NTD ID</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Mode</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Agency Name</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Bio-Diesel</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Bunker Fuel</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">C Natural Gas</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Diesel Fuel</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Electric Battery</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Electric Propulsion</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Ethanol</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Methonal</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Gasoline</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Hydrogen</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Kerosene</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Liquified Nat Gas</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Liquified Petroleum Gas</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CO2_MWh</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">primary_source</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">electricity_price_MWh</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">generation_MWh</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">abbreviation</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Diesel_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Gasoline_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CNG_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LPG_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Bunker_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Ethanol_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Electric_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Total_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Emissions_per_UPT</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Emissions_per_Mile</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Agency_Size</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Car_Emissions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Emissions_Avoided</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">30107</td>
<td style="text-align: left;">West Virginia University, dba: Personal Rapid Transit</td>
<td style="text-align: left;">Morgantown</td>
<td style="text-align: left;">WV</td>
<td style="text-align: right;">1600303</td>
<td style="text-align: right;">2890640</td>
<td style="text-align: right;">30107</td>
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">West Virginia University</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">968750</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1925</td>
<td style="text-align: left;">Coal</td>
<td style="text-align: right;">102.6</td>
<td style="text-align: right;">52286784</td>
<td style="text-align: left;">WV</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1864843750</td>
<td style="text-align: right;">1864843750</td>
<td style="text-align: right;">1165.307</td>
<td style="text-align: right;">645.1318</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">2266262</td>
<td style="text-align: right;">-1862577488</td>
</tr>
</tbody>
</table>


</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Save Results to CSV</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(EMISSIONS_DATA, <span class="st">"Normalized_Emissions.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
</section>
</section>
<section id="task-7-determine-award-winners" class="level2">
<h2 class="anchored" data-anchor-id="task-7-determine-award-winners">Task 7: Determine Award Winners</h2>
<p>This task identifies the top-performing transit agencies based on their environmental performance.</p>
<section id="award-categories" class="level3">
<h3 class="anchored" data-anchor-id="award-categories">Award Categories:</h3>
<ol type="1">
<li><strong>Greenest Transit Agency (Lowest Emissions per Mile):</strong>
<ul>
<li>The agency with the lowest emissions per mile is awarded the title of the greenest transit agency, representing the most environmentally friendly operation.</li>
</ul></li>
<li><strong>Most Emissions Avoided (Comparison with Private Cars):</strong>
<ul>
<li>The agency that avoided the most CO₂ emissions compared to private car travel is recognized for its contribution to reducing pollution and fostering sustainable transit options.</li>
</ul></li>
<li><strong>Best Electrified Agency (Highest % Electric Propulsion):</strong>
<ul>
<li>The agency with the highest percentage of electric propulsion in its fleet is awarded for its commitment to reducing emissions through electric-powered transit.</li>
</ul></li>
<li><strong>Worst Polluter (Highest Emissions per Mile):</strong>
<ul>
<li>The agency with the highest emissions per mile is identified as the worst polluter, highlighting areas where improvements are most urgently needed.</li>
</ul></li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install and load required packages</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages(c("dplyr", "tidyverse", "scales", "glue"))</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  Ensure the emissions dataset exists</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"EMISSIONS_DATA"</span>)){</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"EMISSIONS_DATA is missing. Please run Task 6 first."</span>)</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a><span class="co"># View dataset structure</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(EMISSIONS_DATA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 662
Columns: 40
$ X_5_digit_ntd_id          &lt;int&gt; 1, 1, 1, 1, 1, 1, 2, 2, 2, 3, 3, 3, 5, 5, 6,…
$ Agency                    &lt;chr&gt; "King County, dba: King County Metro", "King…
$ City                      &lt;chr&gt; "Seattle", "Seattle", "Seattle", "Seattle", …
$ State                     &lt;chr&gt; "WA", "WA", "WA", "WA", "WA", "WA", "WA", "W…
$ UPT                       &lt;dbl&gt; 78886848, 78886848, 78886848, 78886848, 7888…
$ MILES                     &lt;dbl&gt; 301530502, 301530502, 301530502, 301530502, …
$ `NTD ID`                  &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 2, 2, 2, 3, 3, 3, 5, 5, 6,…
$ Mode                      &lt;chr&gt; "Demand Response", "Unknown", "Motor Bus", "…
$ `Agency Name`             &lt;chr&gt; "King County", "King County", "King County",…
$ `Bio-Diesel`              &lt;dbl&gt; 0, 208441, 396458, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ `Bunker Fuel`             &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `C Natural Gas`           &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 16539, 1036567, 0…
$ `Diesel Fuel`             &lt;dbl&gt; 17880, 5591, 7049403, 0, 0, 0, 131642, 13355…
$ `Electric Battery`        &lt;dbl&gt; 0, 0, 2411807, 0, 0, 0, 0, 1202138, 0, 0, 26…
$ `Electric Propulsion`     &lt;dbl&gt; 0, 0, 0, 2122439, 13113330, 0, 0, 0, 0, 0, 0…
$ Ethanol                   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Methonal                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Gasoline                  &lt;dbl&gt; 940728, 0, 126689, 0, 0, 379932, 152360, 0, …
$ Hydrogen                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Kerosene                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `Liquified Nat Gas`       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `Liquified Petroleum Gas` &lt;dbl&gt; 292568, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ CO2_MWh                   &lt;dbl&gt; 292, 292, 292, 292, 292, 292, 292, 292, 292,…
$ primary_source            &lt;chr&gt; "Hydroelectric", "Hydroelectric", "Hydroelec…
$ electricity_price_MWh     &lt;dbl&gt; 95.8, 95.8, 95.8, 95.8, 95.8, 95.8, 95.8, 95…
$ generation_MWh            &lt;dbl&gt; 102960605, 102960605, 102960605, 102960605, …
$ abbreviation              &lt;chr&gt; "WA", "WA", "WA", "WA", "WA", "WA", "WA", "W…
$ Diesel_Emissions          &lt;dbl&gt; 400512.0, 125238.4, 157906627.2, 0.0, 0.0, 0…
$ Gasoline_Emissions        &lt;dbl&gt; 18438268.8, 0.0, 2483104.4, 0.0, 0.0, 744666…
$ CNG_Emissions             &lt;dbl&gt; 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,…
$ LPG_Emissions             &lt;dbl&gt; 3715614, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Bunker_Emissions          &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Ethanol_Emissions         &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Electric_Emissions        &lt;dbl&gt; 0, 0, 0, 619752188, 3829092360, 0, 0, 0, 0, …
$ Total_Emissions           &lt;dbl&gt; 2.255439e+07, 1.252384e+05, 1.603897e+08, 6.…
$ Emissions_per_UPT         &lt;dbl&gt; 0.28590817, 0.00158757, 2.03316187, 7.856216…
$ Emissions_per_Mile        &lt;dbl&gt; 7.479971e-02, 4.153424e-04, 5.319188e-01, 2.…
$ Agency_Size               &lt;chr&gt; "Medium", "Medium", "Medium", "Medium", "Med…
$ Car_Emissions             &lt;dbl&gt; 236399914, 236399914, 236399914, 236399914, …
$ Emissions_Avoided         &lt;dbl&gt; 2.138455e+08, 2.362747e+08, 7.601018e+07, -3…</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Identify Award Winners</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  Greenest Transit Agency (Lowest Emissions per Mile)</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>greenest_agency <span class="ot">&lt;-</span> EMISSIONS_DATA <span class="sc">|&gt;</span> </span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(Emissions_per_Mile) <span class="sc">|&gt;</span> </span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  Most Emissions Avoided (Comparison with Private Cars)</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>most_emissions_avoided <span class="ot">&lt;-</span> EMISSIONS_DATA <span class="sc">|&gt;</span> </span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(Emissions_Avoided)) <span class="sc">|&gt;</span> </span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a><span class="co">#  Best Electrified Agency (Highest % Electric Propulsion)</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>best_electric_agency <span class="ot">&lt;-</span> EMISSIONS_DATA <span class="sc">|&gt;</span> </span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Electric_Percentage =</span> <span class="st">`</span><span class="at">Electric Propulsion</span><span class="st">`</span> <span class="sc">/</span> (<span class="fu">rowSums</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"Fuel"</span>)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(Electric_Percentage)) <span class="sc">|&gt;</span> </span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Worst Polluter (Highest Emissions per Mile)</span></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>worst_polluter <span class="ot">&lt;-</span> EMISSIONS_DATA <span class="sc">|&gt;</span> </span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(Emissions_per_Mile)) <span class="sc">|&gt;</span> </span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute median values for reference</span></span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>median_emissions_per_mile <span class="ot">&lt;-</span> <span class="fu">median</span>(EMISSIONS_DATA<span class="sc">$</span>Emissions_per_Mile, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>median_emissions_avoided <span class="ot">&lt;-</span> <span class="fu">median</span>(EMISSIONS_DATA<span class="sc">$</span>Emissions_Avoided, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a>median_electric_percentage <span class="ot">&lt;-</span> <span class="fu">median</span>(best_electric_agency<span class="sc">$</span>Electric_Percentage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
</section>
</section>
<section id="task-8-visualization" class="level2">
<h2 class="anchored" data-anchor-id="task-8-visualization">Task 8: Visualization</h2>
<p>This task focuses on creating key visualizations to better understand various aspects of energy use, emissions, and public transit trends.</p>
<section id="key-visualizations" class="level3">
<h3 class="anchored" data-anchor-id="key-visualizations">Key Visualizations:</h3>
<ol type="1">
<li><strong>Bar Chart – Top 10 States by Electricity Price:</strong>
<ul>
<li>This chart shows the top 10 states with the highest electricity prices, helping to understand how energy costs influence transit operations.</li>
</ul></li>
<li><strong>Scatter Plot – Relationship Between UPT and Total Emissions:</strong>
<ul>
<li>This scatter plot visualizes the relationship between Unlinked Passenger Trips (UPT) and emissions, providing insights into how larger transit systems impact emissions.</li>
</ul></li>
<li><strong>Pie Chart – Primary Energy Sources for Electricity Generation:</strong>
<ul>
<li>This pie chart illustrates the distribution of energy sources used for electricity generation, showcasing the prevalence of coal, natural gas, and renewable energy sources.</li>
</ul></li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required packages</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Bar Chart – Average Electricity Price per MWh by State</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>avg_price_state <span class="ot">&lt;-</span> EMISSIONS_DATA <span class="sc">|&gt;</span> </span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(State) <span class="sc">|&gt;</span> </span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">Average_Electricity_Price =</span> <span class="fu">mean</span>(electricity_price_MWh, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(Average_Electricity_Price)) <span class="sc">|&gt;</span> </span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">10</span>)  <span class="co"># Top 10 states</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(avg_price_state, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(State, Average_Electricity_Price), <span class="at">y =</span> Average_Electricity_Price)) <span class="sc">+</span></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">dollar</span>(Average_Electricity_Price)), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Top 10 States by Electricity Price (Per MWh)"</span>,</span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"State"</span>,</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Electricity Price (USD per MWh)"</span>,</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">"Source: EIA &amp; National Transit Database (2023)"</span></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Electricity_Price_Per_State.png"</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter Plot – Relationship Between UPT and Total Emissions</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(EMISSIONS_DATA, <span class="fu">aes</span>(<span class="at">x =</span> UPT, <span class="at">y =</span> Total_Emissions, <span class="at">color =</span> Agency_Size)) <span class="sc">+</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> comma) <span class="sc">+</span> </span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> comma) <span class="sc">+</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Relationship Between UPT and Total Emissions"</span>,</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">"Does higher transit usage lead to lower per capita emissions?"</span>,</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Unlinked Passenger Trips (log scale)"</span>,</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Total CO₂ Emissions (log scale)"</span>,</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">"Source: National Transit Database (2023)"</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in scale_y_log10(labels = comma): log-10 transformation introduced
infinite values.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-8-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"UPT_vs_Total_Emissions.png"</span>, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in scale_y_log10(labels = comma): log-10 transformation introduced
infinite values.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pie Chart – Distribution of Primary Energy Sources in the US</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>energy_distribution <span class="ot">&lt;-</span> EMISSIONS_DATA <span class="sc">|&gt;</span> </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(primary_source) <span class="sc">|&gt;</span> </span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(energy_distribution, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> n, <span class="at">fill =</span> primary_source)) <span class="sc">+</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_polar</span>(<span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Primary Energy Sources for Electricity Generation"</span>,</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">"Which fuel sources dominate?"</span>,</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">"Source: EIA State Electricity Profiles (2023)"</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-8-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Primary_Energy_Sources.png"</span>, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">7</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>The analysis offers critical insights into the environmental performance of U.S. transit agencies, highlighting areas for improvement and the best practices in sustainability. Key findings include the importance of electrification for reducing emissions, the value of larger transit systems for their operational efficiencies, and the impact of state energy policies on the environmental performance of transit systems.</p>
<p>Through the identification of top-performing transit agencies and detailed visualizations, this report provides a comprehensive understanding of how energy use and emissions in public transit can be optimized to create more sustainable transportation solutions.</p>
<p><strong>Key Insights:</strong></p>
<ul>
<li><p>Electrified transit systems consistently show lower emissions compared to fossil-fuel-powered systems.</p></li>
<li><p>Larger transit systems, with higher Unlinked Passenger Trips (UPT), tend to have lower emissions per capita, demonstrating that mass transit is more sustainable.</p></li>
<li><p>States that rely on coal-heavy energy sources contribute significantly to higher emissions, while states with diverse energy mixes show better environmental performance.</p></li>
<li><p>Best-performing agencies serve as models for creating greener, more sustainable transportation systems across the country.</p></li>
</ul>
<p>This analysis serves as a valuable resource for policymakers, transit agencies, and environmental advocates to understand and improve the sustainability of public transit systems across the U.S.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>